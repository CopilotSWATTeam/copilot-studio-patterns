kind: AdaptiveDialog
inputs:
  - kind: AutomaticTaskInput
    propertyName: inCitations
    name: Input Citations
    description: A table of type System.Response.Citations
    shouldPromptUser: false

beginDialog:
  kind: OnRedirect
  id: main
  priority: 1
  actions:
    - kind: SetMultipleVariables
      id: setVariable_C3FeDS
      assignments:
        - variable: Topic.DEFAULT_ICON
          value: https://raw.githubusercontent.com/CopilotSWATTeam/copilot-studio-patterns/refs/heads/main/icons/40x40/link.png

        - variable: Topic.MAX_TEXT_WIDTH
          value: 512

        - variable: Topic.TRUNCATE_TEXT
          value: true

    - kind: SendActivity
      id: sendActivity_gANZjJ
      activity:
        attachments:
          - kind: HeroCardTemplate
            title: Citation Inspector
            subtitle: "=Concatenate(\"Count of citations: \", CountRows(Topic.inCitations))"

    - kind: Foreach
      id: foreach_5wv7cv
      items: =Topic.inCitations
      value: init:Topic.citation
      index: init:Topic.i
      actions:
        - kind: SetVariable
          id: setVariable_eVsqEk
          displayName: Default Icon
          variable: Topic.iconUrl
          value: =Coalesce(Topic.citation.IconUrl, Topic.DEFAULT_ICON)

        - kind: SetVariable
          id: setVariable_gKuhUM
          variable: Topic.text
          value: =If(Topic.TRUNCATE_TEXT, Lef(Topic.citation.Text, Topic.MAX_TEXT_WIDTH), Topic.citation.Text)

        - kind: SendActivity
          id: sendActivity_j1JqS5
          activity:
            attachments:
              - kind: AdaptiveCardTemplate
                cardContent: |-
                  ={
                    type: "AdaptiveCard",
                    body: [
                      {
                        type: "TextBlock",
                        size: "Medium",
                        weight: "Bolder",
                        text: Topic.citation.Name,
                        id: "txt-citation-name"
                      },
                      {
                        type: "ColumnSet",
                        columns: [
                          {
                            type: "Column",
                            items: [
                              {
                                type: "Image",
                                url: Topic.iconUrl,
                                altText: "",
                                size: "Small",
                                id: "img-icon-url",
                                width: "40px",
                                height: "40px"
                              }
                            ],
                            width: "auto"
                          },
                          {
                            type: "Column",
                            items: [
                              {
                                type: "TextBlock",
                                spacing: "None",
                                text: Concatenate("Id", Topic.citation.Id),
                                isSubtle: true,
                                wrap: true,
                                id: "txt-citation-id"
                              }
                            ],
                            width: "stretch"
                          }
                        ]
                      },
                      {
                        type: "TextBlock",
                        text: Concatenate(Left(Topic.citation.Text, Topic.MAX_TEXT_WIDTH),"..."),
                        wrap: true,
                        id: "txt-citation-text",
                        maxLines: 5
                      }
                    ],
                    actions: [
                      {
                        type: "Action.OpenUrl",
                        title: "Open Citation",
                        id: "btn-open-citation",
                        url: Topic.citation.Url
                      }
                    ],
                    '$schema': "https://adaptivecards.io/schemas/adaptive-card.json",
                    version: "1.5"
                  }

inputType:
  properties:
    inCitations:
      displayName: inCitations
      type:
        kind: Table
        properties:
          IconUrl: String
          Id: String
          Name: String
          Text: String
          Url: String

outputType: {}